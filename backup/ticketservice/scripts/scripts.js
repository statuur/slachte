"use strict";angular.module("slachtemarathonApp",["app.controllers","ngAnimate","ngCookies","ngMessages","ngSanitize","ui.bootstrap","ui.router","angular-google-analytics"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){-1!=document.location.href.indexOf("tickets")&&(a.state("form",{name:"form",url:"/form",templateUrl:"views/form.html",controller:"formController"}).state("form.inloggen",{url:"/inloggen",naam:"inloggen",templateUrl:"views/form-inloggen.html"}).state("form.aantalkaarten",{url:"/aantalkaarten",templateUrl:"views/form-aantalkaarten.html"}).state("form.persoonlijke-gegevens",{url:"/persoonlijke-gegevens",templateUrl:"views/form-persoonlijke-gegevens.html"}).state("form.starttijd",{url:"/starttijd",templateUrl:"views/form-starttijd.html"}).state("form.vervoer",{url:"/vervoer",templateUrl:"views/form-vervoer.html"}).state("form.slapen",{url:"/slapen",templateUrl:"views/form-slapen.html"}).state("form.kleding",{url:"/kleding",templateUrl:"views/form-kleding.html"}).state("form.overzicht",{url:"/overzicht",templateUrl:"views/form-overzicht.html"}).state("form.betalen",{url:"/betalen",templateUrl:"views/form-betalen.html"}).state("bedankt",{url:"/bedankt",templateUrl:"views/bedankt.html",controller:"formController"}),b.otherwise("/form/inloggen")),delete c.defaults.headers.common["X-Requested-With"]}]).config(["AnalyticsProvider",function(a){a.setAccount("UA-2619816-14").logAllCalls(!0).startOffline(!0)}]).run(["Analytics",function(a){}]).run(["$rootScope",function(a){"undefined"==typeof window.localStorage.taal&&(window.localStorage.taal="nl_NL")}]),angular.module("app.controllers",[]).controller("formController",["$locale","$filter","$scope","$http","$state","$transitions","$cookies","$location","$anchorScroll","$uiRouter",function(a,b,c,d,e,f,g,h,i,j){c.$watch("formData.reg.slapen",function(a,b){"Ik slaap thuis"==a&&(c.formData.extrapersonen="",c.extrapersonen="",c.formData.reg.dorp="",c.formData.reg.slaapplek="",c.formData.reg.soortovernachting="",c.formData.reg.nachtenslapen="",c.formData.reg.tentcaravancamper="")}),c.$watch("formData.reg.dorp",function(a,b){"Tritzum"==a?(c.formData.reg.slaapplek="",c.formData.reg.soortovernachting="In eigen tent",c.formData.reg.nachtenslapen="",c.formData.reg.tentcaravancamper="",c.formData.reg.extrapersonen=""):c.formData.reg.soortovernachting=""}),c.$watch("formData.introducees[1].dorp",function(a,b){"Tritzum"==a?(c.formData.introducees[1].slaapplek="",c.formData.introducees[1].soortovernachting="In eigen tent",c.formData.introducees[1].nachtenslapen="",c.formData.introducees[1].tentcaravancamper="",c.formData.introducees[1].extrapersonen=""):c.formData.introducees[1].soortovernachting=""}),c.$watch("formData.introducees[2].dorp",function(a,b){"Tritzum"==a?(c.formData.introducees[2].slaapplek="",c.formData.introducees[2].soortovernachting="In eigen tent",c.formData.introducees[2].nachtenslapen="",c.formData.introducees[2].tentcaravancamper="",c.formData.introducees[2].extrapersonen=""):c.formData.introducees[2].soortovernachting=""}),c.ticketprice=95,c.tshirtprice=18.5,c.hoodieprice=39.5,c.verzendkosten=6.95,c.overnachting=13,c.bijslaper=13,c.mgenders={m:"heren",v:"dames"},c.genders=["m","v"],c.sizes=["s","m","l","xl","xxl"],c.maxkaarten=[1,2,3,4],c.stap=1,c.errors=!1,c.dateOptions={formatYear:"yyyy",datepickerMode:"year",maxDate:new Date(2006,8,30),minDate:new Date(1930,8,30),startingDay:1,showWeeks:!1},c.buttondisabled=!1,c.required="Nog niet alle vereiste velden zijn ingevuld. Kijk de gegevens goed na.",c.sendlogintxt="Vul hieronder het e-mailadres in waarmee je als Freon geregistreerd staat en we versturen de e-mail met login gegevens opnieuw.",c.errortxt="Helaas is er even iets mis met het systeem, herlaad de pagina en probeer het nog eens.",c.sendloginsucces="Er is een e-mail naar je onderweg met de logingegevens. Controleer je e-mail.",c.opstapplekken=["Sneek","Leeuwarden","Heerenveen","Franeker/Harlingen"],c.deelname=[1,2,3,4,5,"nog nooit"],c.formData="undefined"==typeof window.localStorage.formData?{}:JSON.parse(window.localStorage.formData),c.formData.kaarten="undefined"==typeof c.formData.kaarten?"":c.formData.kaarten,c.formData.shirts="undefined"==typeof c.formData.shirts?{}:c.formData.shirts,c.formData.hoodies="undefined"==typeof c.formData.hoodies?{}:c.formData.hoodies,c.formData.reg="undefined"==typeof c.formData.reg?{}:c.formData.reg,c.formData.reg.geboortedatum="undefined"==typeof c.formData.reg?"":new Date(c.formData.reg.geboortedatum),c.personen=["persoon","personen","personen","personen","personen"],c.skaarten=["startkaart","startkaarten"],c.formData.reg.taal="nl_NL",c.betaald=1==g.get("betaald")?1:0,c.formData.user="",c.formData.password="",c.direction="forwards",c.setDirty=function(a){setTimeout(function(){angular.forEach(c.form.$error.required,function(a){a.$setDirty()})},100)},c.alert=function(a){alert(a)},c.initIntroducees=function(){c.formData.introducees="undefined"==typeof c.formData.introducees?[]:c.formData.introducees,c.formData.introducees[0]="undefined"==typeof c.formData.introducees[0]||null===c.formData.introducees[0]?{pwijzigen:"edit"}:c.formData.introducees[0],c.formData.introducees[0].geboortedatum="undefined"==typeof c.formData.introducees[0].geboortedatum?new Date:new Date(c.formData.introducees[0].geboortedatum),c.formData.introducees[1]="undefined"==typeof c.formData.introducees[1]||null===c.formData.introducees[1]?{pwijzigen:"edit"}:c.formData.introducees[1],c.formData.introducees[1].geboortedatum="undefined"==typeof c.formData.introducees[1].geboortedatum?"":new Date(c.formData.introducees[1].geboortedatum),c.formData.introducees[2]="undefined"==typeof c.formData.introducees[2]||null===c.formData.introducees[2]?{pwijzigen:"edit"}:c.formData.introducees[2],c.formData.introducees[2].geboortedatum="undefined"==typeof c.formData.introducees[2].geboortedatum?"":new Date(c.formData.introducees[2].geboortedatum)},c.initIntroducees(),c.copyGegevens=function(a,b){angular.forEach(c.formData.reg,function(d,e){return"user_email"==e||"verzendemail"==e||"sendemail"==e||"email"==e||"email2"==e||"voornaam"==e||"tussenvoegsels"==e||"achternaam"==e||"betaald"==e||"extrapersonen"==e||"geboortedatum"==e||"geslacht"==e||"ID"==e||"user_login"==e?!1:void(c.formData.introducees[b][e]=a?d:"")})},c.setIntroduceData=function(a){var b=["starttijd","vervoer","slapen","dorp","soortovernachting","slaapplek","bagage","nachtenslapen","tentcaravancamper","opstapplek"];angular.forEach(c.formData.reg,function(d,e){b.indexOf(e)>-1&&""!=d&&(c.formData.introducees[a][e]=d)})},c.setError=function(a){c.errors=1,c.errormessage=a,setTimeout(function(){c.errors=0,c.errormessage=""},5e3)},c.showPrice=function(){c.formData.extrapersonen=parseInt(c.formData.reg.extrapersonen),c.totaaltickets=c.formData.kaarten*c.ticketprice,c.totaaltshirts=c.formData.aantaltshirts>0?c.formData.aantaltshirts*c.tshirtprice:0,c.totaalhoodies=c.formData.aantalhoodies>0?c.formData.aantalhoodies*c.hoodieprice:0,c.verzendkostent=c.formData.aantaltshirts>0||c.formData.aantalhoodies>0?c.verzendkosten:0,c.extrapersonen=c.formData.extrapersonen>0?c.formData.extrapersonen:0,c.totaalovernacht=c.overnachting*c.extrapersonen,c.formData.totaalbedrag=(c.totaalovernacht+c.totaaltickets+c.totaaltshirts+c.totaalhoodies+c.verzendkostent).toFixed(2),c.formData.totaaltickets=c.totaaltickets,c.formData.totaaltshirts=c.totaaltshirts,c.formData.totaalhoodies=c.totaalhoodies,c.formData.verzendkosten=c.verzendkostent,c.formData.totaalovernacht=c.totaalovernacht,angular.element(document.getElementById("totaalbedrag")).val(c.totaalbedrag),angular.element(document.getElementById("showtotaalbedrag")).html("&euro; "+c.formData.totaalbedrag)},c.states=[{gegevens:"edit",starttijd:"view",vervoer:"view",slapen:"view",kleding:"view"},{gegevens:"view",starttijd:"view",vervoer:"view",slapen:"view",kleding:"view"},{gegevens:"view",starttijd:"view",vervoer:"view",slapen:"view",kleding:"view"}],c.pstates={kaarten:"view",gegevens:"view",starttijd:"view",vervoer:"view",slapen:"view",kleding:"view"},c.ftemplates={kaarten:{view:"views/blokken/freon-kaarten-view.html",edit:"views/blokken/freon-kaarten-edit.html"},gegevens:{view:"views/blokken/freon-gegevens-view.html",edit:"views/blokken/freon-gegevens-edit.html"},starttijd:{view:"views/blokken/freon-starttijd-view.html",edit:"views/blokken/freon-starttijd-edit.html"},vervoer:{view:"views/blokken/freon-vervoer-view.html",edit:"views/blokken/freon-vervoer-edit.html"},slapen:{view:"views/blokken/freon-slapen-view.html",edit:"views/blokken/freon-slapen-edit.html"},kleding:{view:"views/blokken/freon-kleding-view.html",edit:"views/blokken/freon-kleding-edit.html"}},c.templates={gegevens:{view:"views/blokken/introduce-gegevens-view.html",edit:"views/blokken/introduce-gegevens-edit.html"},starttijd:{view:"views/blokken/introduce-starttijd-view.html",edit:"views/blokken/introduce-starttijd-edit.html"},vervoer:{view:"views/blokken/introduce-vervoer-view.html",edit:"views/blokken/introduce-vervoer-edit.html"},slapen:{view:"views/blokken/introduce-slapen-view.html",edit:"views/blokken/introduce-slapen-edit.html"}},c.toggleTemplate=function(a,b,d){c.states[d][a]=b,angular.forEach(c.states,function(b,e){angular.forEach(b,function(b,f){a!=f?c.states[e][f]="view":e!=d&&(c.states[e][f]="view")})}),window.localStorage.formData=JSON.stringify(c.formData)},c.togglepTemplate=function(a,b){c.pstates[a]=b,"edit"==b&&angular.forEach(c.pstates,function(b,d){d!=a&&(c.pstates[d]="view")}),angular.forEach(c.states,function(a,b){angular.forEach(a,function(a,d){c.states[b][d]="view"})}),window.localStorage.formData=JSON.stringify(c.formData)},c.sendInlog=function(){c.buttondisabled=!0,d({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/sendInlog",data:$.param({email:c.formData.emailfreon,taal:"nl_NL"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){"ok"===a.data.status&&(c.sendlogintxt=c.sendloginsucces,setTimeout(function(){document.location.reload()},8e3)),c.buttondisabled=!1},function(a){c.setError(c.errortxt)})},c.loginError=!1,c.inloggen=function(){c.buttondisabled=!0,c.loginError=!1,d({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/inloggen",data:$.param(c.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){"ok"===a.data.status?("undefined"!=typeof a.data.betaald&&a.data.betaald>1504628362?(j.stateRegistry.deregister("form.aantalkaarten"),j.stateRegistry.deregister("form.persoonlijke-gegevens"),j.stateRegistry.deregister("form.starttijd"),j.stateRegistry.deregister("form.vervoer"),j.stateRegistry.deregister("form.slapen"),j.stateRegistry.deregister("form.kleding"),j.stateRegistry.deregister("form.betalen"),g.put("betaald","1",{secure:!0}),c.betaald=1,c.loggedin=1):(g.put("betaald","0",{secure:!0}),c.betaald=0),c.parseData(a.data),setTimeout(function(){c.menu(),c.setStap(1,"forwards")},500)):c.loginError=!0,c.buttondisabled=!1},function(a){c.setError(c.errortxt)})},c.reminder=0,c.setReminder=function(a){c.reminder=a},c.parseData=function(a){""!=a.reg.geboortedatum&&(a.reg.geboortedatum=new Date(a.reg.geboortedatum)),delete a.reg.shirts,delete a.reg.hoodies,a.reg.email=a.reg.user_email,a.reg.email2=a.reg.user_email,a.user=a.reg.user_login,c.formData=a,c.initIntroducees(),window.localStorage.formData=JSON.stringify(c.formData)},c.isBetaald=function(){void 0===typeof g.get("betaald")||1!=g.get("betaald")||c.loggedin||(j.stateRegistry.deregister("form.aantalkaarten"),j.stateRegistry.deregister("form.persoonlijke-gegevens"),j.stateRegistry.deregister("form.starttijd"),j.stateRegistry.deregister("form.vervoer"),j.stateRegistry.deregister("form.slapen"),j.stateRegistry.deregister("form.kleding"),j.stateRegistry.deregister("form.betalen"),setTimeout(function(){c.menu(),c.setStap(1,"forwards")},500))},c.bedankt=function(){"undefined"==typeof c.formData.reg.ID||""==c.formData.reg.ID?document.location.href="tickets.html":(c.formData.orderID=g.get("orderID"),c.formData.paymentID=g.get("paymentID"),d({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/betaald",data:$.param(c.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){g.remove("betaald"),g.remove("formData"),g.remove("orderID"),g.remove("meelopers"),window.localStorage.clear()},function(a){-1==a.status&&c.setError("Helaas is er even iets mis met het updaten van de betaalstatus, neem contact op met de organisatie en vermeld betalingsID ".$scope.formData.paymentID)}))},c.formData.opslaan=!1,c.voorkeurenOpslaan=function(){c.formData.aanpassen=1,d({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/update",data:$.param(c.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){"ok"===a.data.status&&(g.putObject("betalingsinfo",{userID:c.formData.reg.ID,voornaam:c.formData.reg.voornaam,achternaam:c.formData.reg.achternaam,totaalbedrag:c.formData.totaalbedrag,kaarten:c.formData.kaarten},{secure:!0}),c.alert("gegevens opgeslagen, je wordt nu teruggestuurd naaar inloggen"),e.go("form.inloggen"))},function(a){c.setError(c.errortxt),console.error(a)})},c.setGeboortedata=function(){c.formData.reg.geboortedatum=""!=c.formData.reg.geboortedatum?b("date")(new Date(c.formData.reg.geboortedatum),"yyyy-MM-dd 00:00:00"):c.formData.reg.geboortedatum,angular.forEach(c.formData.introducees,function(a,c){""!=a.user_email&&""!=a.geboortedatum&&(a.geboortedatum=0==new Date(a.geboortedatum).getTime()?"":b("date")(new Date(a.geboortedatum),"yyyy-MM-dd 00:00:00"))})},c.formData.opslaan=!1,c.processForm=function(){window.localStorage.formData=JSON.stringify(c.formData),c.setGeboortedata(),window.localStorage.formData=JSON.stringify(c.formData),c.formData.opslaan=!1,d({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/update",data:$.param(c.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){"ok"===a.data.status?(g.putObject("betalingsinfo",{userID:c.formData.reg.ID,voornaam:c.formData.reg.voornaam,achternaam:c.formData.reg.achternaam,totaalbedrag:c.formData.totaalbedrag,kaarten:c.formData.kaarten},{secure:!0}),document.location.href="betalen.php"):console.error(a)},function(a){c.setError(c.errortxt),console.error(a)})},c.$location=h,c.setStap=function(a,b){c.stap=a,c.direction=b,2==c.stap&&"forwards"==c.direction&&d({method:"POST",url:"https://www.slachtemarathon.nl/api/systeem/aantalKaarten",data:$.param({aantalkaarten:c.formData.kaarten}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){},function(a){}),-1==a?document.location.href="index.html":e.go(c.stappen[a].name),window.localStorage.formData=JSON.stringify(c.formData)},f.onSuccess({},function(a){setTimeout(function(){c.menu()},1010)}),c.menu=function(){var a=e.get(),b=[],d=1,f=0;angular.forEach(a,function(a,b){if(a.name.match(/(form.betalensimulatie)/i))return!1;if(a.name.match(/(form.)/i)){var g=a.name.split("form."),h=g[1];h=h.replace("-"," "),a.title=h,a.active=e.current.name===a.name,c.stap=a.active?f:c.stap,d=e.current.name===a.name?0:d,a.passed=d,a.stap=b,this.push(a),f++}},b),c.stappen=b},c.menu(),d({method:"GET",url:"https://www.slachtemarathon.nl/lightapi/basisinfo/nl_NL"}).then(function(a){c.inschrijving_status=a.data.inschrijving_status,c.dorpen=a.data.dorpen,c.Trainingsshirt=a.data.Trainingsshirt,c.Hoodie=a.data.Hoodie,c.starttijden=a.data.starttijden},function(a){-1==a.status&&c.setError("Helaas is er even iets mis met het systeem, probeer het zo nog even")})}]).controller("welkomController",["$scope","$http","$cookies",function(a,b,c){b({method:"GET",url:"https://www.slachtemarathon.nl/lightapi/status/"}).then(function(b){delete b.data.status,a.inschrijving_status=b.data.inschrijving_status},function(b){a.setError(a.errortxt)}),a.cookieAgree="undefined"==typeof c.get("cookies")?0:c.get("cookies"),a.cookiea="Ga je akkoord met de Cookie instellingen?",a.alert=function(a){alert(a)},a.setError=function(b){a.errors=1,a.errormessage=b,setTimeout(function(){a.errors=0,a.errormessage=""},5e3)},a.cookieAgreement=function(b){var d=new Date;d.setDate(d.getDate()+1),c.put("cookies",1,{expires:d}),a.cookieAgree=1},a.setLanguage=function(a){document.location.href="tickets.html"}}]).directive("freonenEmailExists",["$http","$q",function(a,b){return{require:"ngModel",link:function(c,d,e,f){f.$asyncValidators.freonenEmailExists=function(d,e){return f.$pristine||c.originalEmail===f.$viewValue?b(function(a){a(1)}):a({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/emailCheck",data:$.param({email:f.$viewValue}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a.data.exists?b.resolve("goed e-mailadres"):b.reject("e-mail bestaat niet")},function(a){return console.error(a),b.reject("selected username does not exists")})}}}}]).directive("emailExists",["$http","$q",function(a,b){return{require:"ngModel",link:function(c,d,e,f){f.$asyncValidators.emailExists=function(d,e){return f.$pristine||c.originalEmail===f.$viewValue?b(function(a){a(1)}):a({method:"POST",url:"https://www.slachtemarathon.nl/api/freon/emailCheck",data:$.param({email:f.$viewValue}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a.data.exists?b.reject("e-mail bestaat al"):b.resolve("goed e-mailadres")},function(a){return console.error(a),b.reject("selected username does not exists")})}}}}]).directive("matchValidator",[function(){return{require:"ngModel",link:function(a,b,c,d){var e=b.inheritedData("$formController")[c.matchValidator];d.$parsers.push(function(a){return a===e.$viewValue?(d.$setValidity("match",!0),a):void(a&&e.$viewValue&&d.$setValidity("match",!1))}),e.$parsers.push(function(a){return a&&d.$viewValue&&d.$setValidity("match",a===d.$viewValue),a})}}}]);